<h1>ZStack</h1>

<h2>Overview</h2>

<ul>
<li>The dependency has completed now</li>
<li>The packages are platform</li>
<li>The object files are located in packages, avoid some name conflict</li>
<li>The workspaces can be distinguished by package which we work on</li>
</ul>

<h2>Directory</h2>

<pre><code>workspace-x86-core/
    Makefile (auto generated by tool)
    board-qemu-x86/
        README.txt
        debug.sh
        board.lds
        memory_map.h
        irq_map.h
    core-x86/
        README.txt
        Makefile
        start.S
        start.o
    lib-c/
    ...
</code></pre>

<ul>
<li>Board Package: memory layout and symbol layout</li>
<li>Other Package: symbols set</li>
</ul>

<h2>Root Makefile</h2>

<pre><code>CC = gcc
LD = ld

CFLAGS = -g ... // options should be top-level
LDFLAGS = -T ...

zstack: lib&lt;package&gt;.a ...
    $(LD) $(LDFLAGS) $@ $^
</code></pre>

<h2>Package Makefile</h2>

<pre><code>lib&lt;package&gt;.a: ...
    $(AR) ...

%.o: %.c
    $(CC) $(CFLAGS) $@ $&lt;
</code></pre>

<h2>Dependency</h2>

<pre><code>DEPEND-ON: x86-core
</code></pre>
